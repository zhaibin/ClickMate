# æ‰“åŒ…å‘å¸ƒæŒ‡å—

ClickMate è·¨å¹³å°æ‰“åŒ…å‘å¸ƒå®Œæ•´æŒ‡å—ï¼Œæ”¯æŒ Windows å’Œ macOSã€‚

---

## ğŸ“‹ å‘ç‰ˆæ¸…å•

åœ¨å‘å¸ƒå‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] å¿«æ·é”®åŠŸèƒ½æ­£å¸¸ï¼ˆWindows éœ€ç®¡ç†å‘˜æƒé™ï¼ŒmacOS éœ€è¾…åŠ©åŠŸèƒ½æƒé™ï¼‰
- [ ] ç‚¹å‡»å†å²æ˜¾ç¤ºæ­£å¸¸
- [ ] å¤šè¯­è¨€åˆ‡æ¢æ­£å¸¸ï¼ˆè‡³å°‘æµ‹è¯•3ç§è¯­è¨€ï¼‰
- [ ] é…ç½®ä¿å­˜/åŠ è½½æ­£å¸¸
- [ ] VERSION æ–‡ä»¶å·²æ›´æ–°
- [ ] lib/version.dart å·²æ›´æ–°
- [ ] CHANGELOG.md å·²æ›´æ–°
- [ ] README.md ç‰ˆæœ¬å·å·²æ›´æ–°
- [ ] Git å·²æäº¤å¹¶æ‰“æ ‡ç­¾
- [ ] åœ¨å¹²å‡€ç³»ç»Ÿä¸Šæµ‹è¯•é€šè¿‡

---

## ğŸªŸ Windows æ‰“åŒ…

### æ–¹å¼1ï¼šä¾¿æºç‰ˆ âœ¨æ¨è

**å‘½ä»¤ï¼š**
```bash
scripts\build_release.bat
```

**è‡ªåŠ¨å®Œæˆï¼š**
1. æ£€æŸ¥ DLL æ–‡ä»¶
2. æ„å»º Release ç‰ˆæœ¬
3. åˆ›å»ºä¾¿æºç‰ˆæ–‡ä»¶å¤¹
4. æ‰“åŒ… ZIP å‹ç¼©åŒ…

**è¾“å‡ºç»“æœï¼š**
```
releases\v2.0.0\
â”œâ”€â”€ ClickMate_v2.0.0_Portable\
â”‚   â”œâ”€â”€ clickmate.exe
â”‚   â”œâ”€â”€ flutter_windows.dll
â”‚   â”œâ”€â”€ mouse_controller.dll
â”‚   â”œâ”€â”€ data\
â”‚   â””â”€â”€ (å…¶ä»–æ’ä»¶ DLL)
â””â”€â”€ ClickMate_v2.0.0_Portable.zip
```

### æ–¹å¼2ï¼šå• EXE æ‰“åŒ…

**éœ€è¦å·¥å…·ï¼š** Enigma Virtual Boxï¼ˆå…è´¹ï¼‰
- ä¸‹è½½ï¼šhttps://enigmaprotector.com/en/downloads.html

**æ­¥éª¤ï¼š**
1. å…ˆè¿è¡Œ `build_release.bat` ç”Ÿæˆä¾¿æºç‰ˆ
2. ä½¿ç”¨ Enigma Virtual Box æ‰“åŒ…æ‰€æœ‰æ–‡ä»¶ä¸ºå•ä¸ª EXE

### æ–¹å¼3ï¼šå®‰è£…ç¨‹åº

**éœ€è¦å·¥å…·ï¼š** Inno Setupï¼ˆå…è´¹ï¼‰
- ä¸‹è½½ï¼šhttps://jrsoftware.org/isdl.php

**æ­¥éª¤ï¼š**
1. å…ˆè¿è¡Œ `build_release.bat` ç”Ÿæˆä¾¿æºç‰ˆ
2. åˆ›å»º Inno Setup è„šæœ¬æ‰“åŒ…ä¸ºå®‰è£…ç¨‹åº

### æ‰‹åŠ¨æ‰“åŒ…

```cmd
# 1. æ„å»º Release ç‰ˆæœ¬
flutter build windows --release

# 2. å¤åˆ¶ DLL
copy native\src\mouse_controller.dll build\windows\x64\runner\Release\

# 3. æ‰“åŒ…æ•´ä¸ª Release æ–‡ä»¶å¤¹
```

---

## ğŸ macOS æ‰“åŒ…

### âš ï¸ é‡è¦è¯´æ˜ï¼šNative Library æ‰“åŒ…

macOS åº”ç”¨éœ€è¦å°† `libmouse_controller.dylib` æ­£ç¡®æ‰“åŒ…åˆ°åº”ç”¨åŒ…å†…ã€‚

**é—®é¢˜ï¼š** å¦‚æœåªè¿è¡Œ `flutter build macos --release`ï¼Œdylib ä¸ä¼šè‡ªåŠ¨åŒ…å«åœ¨ `.app` åŒ…å†…ï¼Œå¯¼è‡´åˆ†å‘ç»™ç”¨æˆ·ååº”ç”¨æ— æ³•å¯åŠ¨ï¼ŒæŠ¥é”™ï¼š`Unsupported operation: Could not load libmouse_controller.dylib`

**è§£å†³æ–¹æ¡ˆï¼š** ä½¿ç”¨ `scripts/build_dmg.sh` è„šæœ¬ï¼Œå®ƒä¼šè‡ªåŠ¨ï¼š
1. ç¼–è¯‘ native libraryï¼ˆå¦‚æœéœ€è¦ï¼‰
2. æ„å»º Flutter åº”ç”¨
3. å°† dylib å¤åˆ¶åˆ° `ClickMate.app/Contents/Frameworks/`
4. è®¾ç½®æ­£ç¡®çš„ install_nameï¼ˆä½¿ç”¨ `@executable_path/../Frameworks/`ï¼‰
5. åˆ›å»º DMG å®‰è£…åŒ…

### æ–¹å¼1ï¼šDMG å®‰è£…åŒ… âœ¨æ¨è

**å‘½ä»¤ï¼š**
```bash
bash scripts/build_dmg.sh
```

**è¾“å‡ºç»“æœï¼š**
```
releases/v2.1.0/
â”œâ”€â”€ ClickMate_v2.1.0_macOS.dmg
â””â”€â”€ (æ„å»ºçš„ .app åœ¨ build/macos/Build/Products/Release/)
```

**è‡ªåŠ¨å®Œæˆï¼š**
1. æ¸…ç†æ—§æ„å»º
2. è·å–ä¾èµ–
3. ç¼–è¯‘ native libraryï¼ˆlibmouse_controller.dylibï¼‰
4. æ„å»º Release ç‰ˆæœ¬
5. **å°† dylib å¤åˆ¶åˆ° app bundle çš„ Frameworks ç›®å½•**
6. **è®¾ç½®æ­£ç¡®çš„ dylib install_name**
7. åˆ›å»º DMG å®‰è£…åŒ…

**åˆ†å‘æ–¹å¼ï¼š**
- ç›´æ¥åˆ†å‘ `.dmg` æ–‡ä»¶
- ç”¨æˆ·æ‰“å¼€ DMGï¼Œæ‹–åŠ¨åº”ç”¨åˆ°ã€Œåº”ç”¨ç¨‹åºã€æ–‡ä»¶å¤¹

### æ–¹å¼2ï¼šApp Bundle

**å‘½ä»¤ï¼š**
```bash
flutter build macos --release
```

**è¾“å‡ºç»“æœï¼š**
```
build/macos/Build/Products/Release/ClickMate.app
```

**âš ï¸ é‡è¦ï¼š** æ‰‹åŠ¨æ‰“åŒ…æ—¶å¿…é¡»å°† dylib å¤åˆ¶åˆ°åº”ç”¨åŒ…å†…ï¼š
```bash
# å¤åˆ¶ dylib åˆ°åº”ç”¨åŒ…
FRAMEWORKS_DIR="build/macos/Build/Products/Release/ClickMate.app/Contents/Frameworks"
mkdir -p "$FRAMEWORKS_DIR"
cp native/src/libmouse_controller.dylib "$FRAMEWORKS_DIR/"

# è®¾ç½®æ­£ç¡®çš„ install_name
install_name_tool -id "@executable_path/../Frameworks/libmouse_controller.dylib" \
    "$FRAMEWORKS_DIR/libmouse_controller.dylib"
```

**åˆ†å‘æ–¹å¼ï¼š**
1. å°† `.app` æ–‡ä»¶å‹ç¼©ä¸º `.zip`
2. ç”¨æˆ·è§£å‹åæ‹–å…¥ã€Œåº”ç”¨ç¨‹åºã€æ–‡ä»¶å¤¹

### macOS ä»£ç ç­¾åï¼ˆæ­£å¼åˆ†å‘æ¨èï¼‰

**éœ€è¦ï¼š**
- Apple Developer è´¦å·
- ä»£ç ç­¾åè¯ä¹¦

```bash
# ç­¾ååº”ç”¨
codesign --force --deep --sign "Developer ID Application: Your Name" \
  build/macos/Build/Products/Release/ClickMate.app

# ç­¾å DMG
codesign --force --sign "Developer ID Application: Your Name" \
  releases/v2.1.0/ClickMate_v2.1.0_macOS.dmg

# Notarizationï¼ˆå…¬è¯ï¼Œå¯é€‰ä½†æ¨èï¼‰
xcrun notarytool submit ClickMate_v2.1.0_macOS.dmg \
  --apple-id YOUR_ID --password YOUR_PASSWORD --team-id YOUR_TEAM
```

---

## ğŸ“¦ æ‰“åŒ…å¯¹æ¯”

| ç‰¹æ€§ | Windows ä¾¿æºç‰ˆ | Windows å®‰è£…ç¨‹åº | macOS App | macOS DMG |
|------|---------------|-----------------|-----------|-----------|
| æ–‡ä»¶æ•°é‡ | å¤šä¸ª | 1ä¸ª | 1ä¸ª | 1ä¸ª |
| æ–‡ä»¶å¤§å° | ~25MB | ~20MB | ~30MB | ~35MB |
| éœ€è¦å·¥å…· | æ—  | Inno Setup | æ—  | create-dmg |
| ç”¨æˆ·ä½“éªŒ | è§£å‹å³ç”¨ | å®‰è£…å‘å¯¼ | æ‹–å…¥åº”ç”¨ | æ‹–å…¥åº”ç”¨ |
| æ¨èåœºæ™¯ | ä¸ªäººåˆ†å‘ | æ­£å¼å‘å¸ƒ | ä¸ªäººåˆ†å‘ | æ­£å¼å‘å¸ƒ |

---

## ğŸ”§ å¹³å°ç‰¹å®šæ³¨æ„äº‹é¡¹

### Windows

1. **DLL ä¾èµ–**
   - `flutter_windows.dll` - Flutter è¿è¡Œæ—¶
   - `mouse_controller.dll` - é¼ æ ‡æ§åˆ¶åº“
   - æ’ä»¶ DLLï¼ˆscreen_retriever, window_manager ç­‰ï¼‰

2. **è¿è¡Œæ—¶è¦æ±‚**
   - Visual C++ Redistributable 2022
   - Windows 10 1809+

3. **ç®¡ç†å‘˜æƒé™**
   - å¿«æ·é”®åŠŸèƒ½éœ€è¦ç®¡ç†å‘˜æƒé™
   - å»ºè®®åœ¨å‘å¸ƒè¯´æ˜ä¸­æç¤ºç”¨æˆ·

### macOS

1. **åŠ¨æ€åº“**
   - `libmouse_controller.dylib` ä¼šè¢«è‡ªåŠ¨æ‰“åŒ…åˆ° App Bundle

2. **æƒé™è¦æ±‚**
   - è¾…åŠ©åŠŸèƒ½æƒé™ï¼ˆAccessibilityï¼‰
   - é¦–æ¬¡è¿è¡Œä¼šæç¤ºç”¨æˆ·æˆæƒ

3. **ä»£ç ç­¾å**
   - æœªç­¾åçš„ App ä¼šæ˜¾ç¤ºã€Œæ— æ³•éªŒè¯å¼€å‘è€…ã€
   - ç”¨æˆ·éœ€è¦åœ¨ã€Œç³»ç»Ÿåå¥½è®¾ç½® â†’ å®‰å…¨æ€§ä¸éšç§ã€ä¸­å…è®¸è¿è¡Œ

4. **Gatekeeper**
   - å»ºè®®è¿›è¡Œä»£ç ç­¾åå’Œå…¬è¯
   - å¦åˆ™ç”¨æˆ·éœ€è¦å³é”®ç‚¹å‡» App é€‰æ‹©ã€Œæ‰“å¼€ã€

---

## ğŸ“ å‘å¸ƒåŒ…å†…å®¹

### Windows ä¾¿æºç‰ˆ

```
ClickMate_v2.0.0_Portable/
â”œâ”€â”€ clickmate.exe              # ä¸»ç¨‹åº
â”œâ”€â”€ flutter_windows.dll        # Flutter è¿è¡Œæ—¶
â”œâ”€â”€ mouse_controller.dll       # é¼ æ ‡æ§åˆ¶åº“
â”œâ”€â”€ data/                      # èµ„æºæ–‡ä»¶
â”œâ”€â”€ screen_retriever_windows_plugin.dll
â”œâ”€â”€ window_manager_plugin.dll
â””â”€â”€ README.txt                 # ä½¿ç”¨è¯´æ˜
```

### macOS App Bundle

```
ClickMate.app/
â”œâ”€â”€ Contents/
â”‚   â”œâ”€â”€ MacOS/
â”‚   â”‚   â””â”€â”€ ClickMate          # å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â”œâ”€â”€ Frameworks/
â”‚   â”‚   â””â”€â”€ (Flutter frameworks)
â”‚   â”œâ”€â”€ Resources/
â”‚   â”‚   â””â”€â”€ (assets)
â”‚   â””â”€â”€ Info.plist
```

---

## ğŸš€ æ ‡å‡†å‘ç‰ˆæµç¨‹

### 1. å‡†å¤‡é˜¶æ®µ

```bash
# æ›´æ–°ç‰ˆæœ¬å·
# ç¼–è¾‘ VERSION æ–‡ä»¶
# ç¼–è¾‘ lib/version.dart
# ç¼–è¾‘ CHANGELOG.md
# ç¼–è¾‘ README.md
```

### 2. æµ‹è¯•é˜¶æ®µ

```bash
# Windows
scripts\run_debug.bat
scripts\test_hotkey.bat

# macOS
flutter run -d macos
```

### 3. æ„å»ºé˜¶æ®µ

```bash
# Windows
scripts\build_release.bat

# macOS
flutter build macos --release
```

### 4. éªŒè¯é˜¶æ®µ

- åœ¨å¹²å‡€ç³»ç»Ÿä¸Šæµ‹è¯•
- æ£€æŸ¥æ‰€æœ‰åŠŸèƒ½
- éªŒè¯å¤šè¯­è¨€

### 5. å‘å¸ƒé˜¶æ®µ

```bash
# Git æäº¤
git add -A
git commit -m "release: v2.0.0"
git tag v2.0.0
git push origin master --tags
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q: Windows æ‰“åŒ…åæ— æ³•è¿è¡Œï¼Ÿ
**A:** æ£€æŸ¥æ˜¯å¦ç¼ºå°‘ DLL æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ `mouse_controller.dll`

### Q: macOS App æç¤ºã€Œå·²æŸåã€ï¼Ÿ
**A:** è¿™æ˜¯ Gatekeeper é™åˆ¶ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
xattr -cr /path/to/ClickMate.app
```

### Q: macOS å¿«æ·é”®æ— å“åº”ï¼Ÿ
**A:** æ£€æŸ¥è¾…åŠ©åŠŸèƒ½æƒé™æ˜¯å¦å·²æˆäºˆ

### Q: æ–‡ä»¶å¤ªå¤§æ€ä¹ˆåŠï¼Ÿ
**A:** Flutter æœ€å°è¿è¡Œæ—¶çº¦ 15-20MBï¼Œæ— æ³•è¿›ä¸€æ­¥å‹ç¼©

### Q: å¦‚ä½•å‡å°‘æ‰“åŒ…ä½“ç§¯ï¼Ÿ
- ç§»é™¤æœªä½¿ç”¨çš„èµ„æº
- ä½¿ç”¨ `flutter build --release`
- è€ƒè™‘ä½¿ç”¨å‹ç¼©å·¥å…·

---

## ğŸ“š ç›¸å…³èµ„æº

- [Flutter Windows éƒ¨ç½²](https://docs.flutter.dev/deployment/windows)
- [Flutter macOS éƒ¨ç½²](https://docs.flutter.dev/deployment/macos)
- [Enigma Virtual Box](https://enigmaprotector.com/)
- [Inno Setup](https://jrsoftware.org/isinfo.php)
- [create-dmg](https://github.com/create-dmg/create-dmg)

---

**ç¥æ‚¨æ‰“åŒ…é¡ºåˆ©ï¼** ğŸ‰

**Last Updated**: 2024-11-29  
**Version**: 2.0.0
