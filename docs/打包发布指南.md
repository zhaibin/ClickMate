# 打包发布指南

## 📦 三种打包方式

我为您准备了三种打包方式，可以根据需求选择：

### 方式1: 单EXE文件打包 ⭐推荐
**文件**: `build_single_exe.bat`  
**结果**: 一个独立的exe文件（约30-50MB）  
**优点**: 
- ✅ 真正的单文件，无需其他依赖
- ✅ 方便分发，直接运行
- ✅ 不会暴露目录结构

**缺点**:
- ❌ 需要安装 Enigma Virtual Box（免费工具）
- ❌ 文件较大
- ❌ 首次运行会稍慢（需要解压内部文件）

---

### 方式2: 安装程序 
**文件**: `build_installer.bat`  
**结果**: 专业的安装程序（Setup.exe）  
**优点**:
- ✅ 专业的安装/卸载界面
- ✅ 自动创建开始菜单和桌面快捷方式
- ✅ 文件大小较小（压缩后）
- ✅ 符合Windows软件规范

**缺点**:
- ❌ 需要安装 Inno Setup（免费工具）
- ❌ 用户需要安装过程

---

### 方式3: 便携版（文件夹）✨推荐
**文件**: `build_portable.bat`  
**结果**: 一个包含所有文件的文件夹 + ZIP压缩包  
**优点**:
- ✅ 不需要额外工具
- ✅ 绿色软件，无需安装
- ✅ 可以放在U盘使用
- ✅ 文件结构清晰，易于维护

**缺点**:
- ❌ 多个文件（4个文件 + 1个文件夹）
- ❌ 不能移动单个exe文件

---

## 🚀 使用方法

### 方式1: 单EXE打包（推荐给最终用户）

#### 第一步：安装 Enigma Virtual Box
1. 访问: https://enigmaprotector.com/en/downloads.html
2. 下载并安装 Enigma Virtual Box（完全免费）
3. 安装到默认位置即可

#### 第二步：运行打包脚本
```bash
build_single_exe.bat
```

#### 过程说明：
```
[1/5] 检查DLL文件
[2/5] 复制DLL到根目录
[3/5] 构建Flutter Release版本
[4/5] 复制DLL到Release目录
[5/5] 生成打包配置并打包
```

#### 输出结果：
```
build\鼠标自动控制器.exe    (约40MB)
```

✅ **这就是最终的单文件！可以直接分发给用户**

---

### 方式2: 制作安装程序

#### 第一步：安装 Inno Setup
1. 访问: https://jrsoftware.org/isdl.php
2. 下载并安装 Inno Setup 6（完全免费）
3. 安装时选择中文语言包

#### 第二步：运行打包脚本
```bash
build_installer.bat
```

#### 输出结果：
```
build\鼠标自动控制器_Setup.exe    (约15-20MB)
```

✅ **用户运行Setup.exe后会进入安装向导**

---

### 方式3: 便携版打包（最简单）✨

#### 直接运行：
```bash
build_portable.bat
```

#### 输出结果：
```
build\MouseControl_Portable\        (文件夹)
  ├── mouse_control.exe
  ├── flutter_windows.dll
  ├── mouse_controller.dll
  ├── data\
  ├── 使用说明.txt
  ├── CHANGELOG.md
  └── 完整代码说明.md

build\鼠标自动控制器_v1.1.0_便携版.zip    (约20MB)
```

✅ **直接分发ZIP文件，用户解压后运行mouse_control.exe**

---

## 📋 详细对比

| 特性 | 单EXE | 安装程序 | 便携版 |
|------|-------|----------|--------|
| 文件数量 | 1个 | 1个(安装器) | 多个 |
| 文件大小 | 约40MB | 约15MB | 约20MB |
| 需要工具 | Enigma VB | Inno Setup | 无 |
| 制作难度 | 简单 | 简单 | 最简单 |
| 分发难度 | 最简单 | 简单 | 简单 |
| 用户体验 | 优秀 | 专业 | 良好 |
| 启动速度 | 稍慢 | 快 | 快 |
| 推荐场景 | 快速分发 | 正式发布 | 绿色版本 |

---

## 🎯 推荐方案

### 对于个人使用/小范围分发
→ **使用便携版** (`build_portable.bat`)
- 最简单，不需要安装额外工具
- 用户解压即用

### 对于给朋友/同事使用
→ **使用单EXE** (`build_single_exe.bat`)
- 只有一个文件，最方便
- 不会搞混其他文件

### 对于正式发布/商业使用
→ **使用安装程序** (`build_installer.bat`)
- 最专业
- 有完整的安装/卸载流程

---

## 🛠️ 手动打包（不使用脚本）

如果您想手动打包，按以下步骤：

### 1. 构建Release版本
```bash
flutter build windows --release
```

### 2. 找到输出目录
```
build\windows\x64\runner\Release\
```

### 3. 复制必需文件
```
build\windows\x64\runner\Release\
├── mouse_control.exe          ← 主程序
├── flutter_windows.dll        ← Flutter运行时
├── mouse_controller.dll       ← 需要手动复制！
└── data\                      ← 资源文件夹
```

### 4. 复制mouse_controller.dll
```bash
copy native\src\mouse_controller.dll build\windows\x64\runner\Release\
```

### 5. 打包
- **ZIP压缩**: 选中所有文件，右键 → 发送到 → 压缩文件夹
- **单EXE**: 使用 Enigma Virtual Box 手动打包
- **安装程序**: 使用 Inno Setup 手动制作

---

## ⚠️ 常见问题

### Q1: 打包后无法运行？
**原因**: 缺少 `mouse_controller.dll`

**解决**:
```bash
# 确保DLL在Release目录
copy native\src\mouse_controller.dll build\windows\x64\runner\Release\
```

### Q2: Enigma Virtual Box找不到？
**解决**:
1. 确认已安装到默认路径
2. 或修改 `build_single_exe.bat` 中的路径：
```batch
set "EVB_PATH=你的安装路径\enigmavb.exe"
```

### Q3: 单EXE运行报错？
**原因**: 文件损坏或打包不完整

**解决**:
1. 重新运行 `build_single_exe.bat`
2. 确认构建过程无错误
3. 尝试使用便携版

### Q4: 文件太大怎么办？
**优化方法**:
1. 使用 UPX 压缩（不推荐，可能被杀毒软件误报）
2. 使用便携版 + ZIP压缩
3. 使用安装程序（自带高压缩）

### Q5: 能否更小的文件？
**理论最小大小**:
- Flutter Windows运行时: ~15MB（无法减少）
- 应用代码和资源: ~5MB
- mouse_controller.dll: <1MB
- **总计**: 约20MB（这是极限）

---

## 📝 发布清单

在发布前，请确认：

- [ ] 所有功能测试通过
- [ ] 快捷键功能正常
- [ ] 点击历史显示正常
- [ ] 在干净的Windows系统上测试
- [ ] DLL文件已包含
- [ ] 创建了使用说明
- [ ] 更新了版本号
- [ ] 准备了截图/演示

---

## 📦 推荐发布包内容

### 最小发布包（便携版）
```
鼠标自动控制器_v1.1.0.zip
├── mouse_control.exe
├── flutter_windows.dll
├── mouse_controller.dll
├── data\
└── 使用说明.txt
```

### 完整发布包
```
鼠标自动控制器_v1.1.0_完整版.zip
├── mouse_control.exe
├── flutter_windows.dll
├── mouse_controller.dll
├── data\
├── 使用说明.txt
├── CHANGELOG.md
├── 完整代码说明.md
└── 截图\
    ├── 主界面.png
    ├── 快捷键设置.png
    └── 点击历史.png
```

---

## 🎉 快速开始

**我最推荐的流程**：

1. **开发测试阶段**: 使用 `run_debug.bat`
2. **打包分发**: 使用 `build_portable.bat`
3. **正式发布**: 使用 `build_single_exe.bat` 或 `build_installer.bat`

**一键打包便携版**：
```bash
build_portable.bat
```
输出的ZIP文件就可以直接分发了！

---

## 📚 相关资源

- Enigma Virtual Box: https://enigmaprotector.com/en/downloads.html
- Inno Setup: https://jrsoftware.org/isdl.php
- Flutter Windows部署: https://docs.flutter.dev/deployment/windows

---

**祝您打包顺利！** 🎉

如有问题，请查看控制台输出的错误信息。

