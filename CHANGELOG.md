# 更新日志

## 版本 1.4.3

### 🔒 隐私保护与日志优化

#### 日志系统重大调整
- ✅ **仅记录异常** - 日志系统改为仅记录软件异常（警告和错误）
- ✅ **保护隐私** - 不再记录用户行为（点击次数、启动停止、位置捕获等）
- ✅ **减少文件大小** - 正常运行时日志文件为空或很小
- ✅ **日志级别调整** - 从 DEBUG 调整为 WARNING（Level.warning）

#### 移除的日志内容
- ❌ 不再记录：点击统计（DEBUG级别）
- ❌ 不再记录：启动/停止操作（INFO级别）
- ❌ 不再记录：热键触发（INFO级别）
- ❌ 不再记录：位置捕获（INFO级别）
- ❌ 不再记录：参数变更（INFO级别）

#### 保留的日志内容
- ✅ 仍记录：系统初始化失败（ERROR级别）
- ✅ 仍记录：DLL加载失败（ERROR级别）
- ✅ 仍记录：热键注册失败（WARNING级别）
- ✅ 仍记录：配置问题（WARNING级别）
- ✅ 仍记录：其他异常情况

#### 文档更新
- ✅ 更新 `docs/日志系统说明.md` - 反映新的异常日志策略
- ✅ 说明正常运行时日志文件为空是正常现象
- ✅ 调试时仍可使用"调试启动.bat"查看控制台详细输出

#### 更新时间
- 2024-11-21

#### 技术说明
- 此版本专注于隐私保护，不影响软件功能
- 如需查看详细运行信息，请使用 `scripts\run_debug.bat`
- 正常情况下日志文件为空属于预期行为

---

## 版本 1.4.2

### ✨ 品牌升级与用户体验改进

#### 软件更名
- ✅ **全新品牌名称：ClickMate**
- ✅ 所有语言统一显示 "ClickMate"（不翻译，保持国际化一致性）
- ✅ 简洁、易记、专业的品牌形象

#### 新增功能
- ✅ **内置帮助系统** - 标题栏新增帮助按钮（❓图标）
- ✅ **使用指南** - 包含快速开始、自动模式、手动模式、快捷键说明
- ✅ **常见问题解答** - 4个常见问题及详细解答（快捷键、DLL、管理员权限、模式切换）
- ✅ **多语言支持** - 帮助和FAQ完整支持11种语言
- ✅ **友好界面** - 彩色分组、图标提示、易于阅读

#### 界面优化
- ✅ **应用图标** - 设置了自定义应用图标（1024x1024高清图标，自动生成多尺寸ICO）
- ✅ **窗口锁定** - 禁止调整窗口大小，保持固定尺寸（520x680），提供一致的用户体验

#### 更新时间
- 2024-11-21

---

## 版本 1.4.1

### 🌏 新增语言支持 ⭐

#### 新增语言
- ✅ **日本語** (Japanese) - 完整翻译
- ✅ **한국어** (Korean) - 完整翻译

#### 现支持11种语言
1. English (英语)
2. 简体中文 (Simplified Chinese)
3. 繁體中文 (Traditional Chinese)
4. Français (法语)
5. Español (西班牙语)
6. Português (葡萄牙语)
7. Deutsch (德语)
8. Русский (俄语)
9. Italiano (意大利语)
10. **日本語** (日语) - 新增
11. **한국어** (韩语) - 新增

#### 更新内容
- ✅ 完整的日语界面翻译（60+ 文本）
- ✅ 完整的韩语界面翻译（60+ 文本）
- ✅ 语言选择器新增日语和韩语选项
- ✅ 语言偏好自动保存支持新语言
- ✅ **系统语言检测** - 首次启动自动跟随系统语言
- ✅ 智能语言匹配（中文区分简繁体，不支持的语言回退到英语）

### 📦 发布内容
- `releases/v1.4.1/MouseControl_v1.4.1_Portable.zip`

---

## 版本 1.4.0

### 🌍 多语言支持 ⭐

#### 新增语言
- ✅ **9种语言支持**：
  - English (英语) - 默认语言
  - 简体中文 (Simplified Chinese)
  - 繁體中文 (Traditional Chinese)
  - Français (法语)
  - Español (西班牙语)
  - Português (葡萄牙语)
  - Deutsch (德语)
  - Русский (俄语)
  - Italiano (意大利语)

#### 功能特性
- ✅ **语言切换** - 点击标题栏语言图标切换语言
- ✅ **系统语言检测** - 首次启动自动跟随系统语言
- ✅ **自动保存** - 语言偏好自动保存，下次启动记住选择
- ✅ **完整翻译** - 所有界面文本、按钮、提示信息均已翻译
- ✅ **代码英文化** - 所有代码注释和日志改为英文
- ✅ **国际化架构** - 使用Flutter官方国际化方案

#### 技术实现
- ✅ 创建 `lib/l10n/app_localizations.dart` - 完整的多语言本地化系统
- ✅ 创建 `lib/language_preference.dart` - 语言偏好持久化服务
- ✅ 更新 `lib/main.dart` - 集成多语言支持
- ✅ 更新 `pubspec.yaml` - 添加 `flutter_localizations` 依赖

#### 使用说明
1. **首次启动** - 自动检测并使用系统语言
2. **切换语言** - 点击标题栏右上角的**地球图标**🌐
3. 在弹出的语言列表中选择你想要的语言
4. 语言立即生效，下次启动自动使用上次选择

### 📦 发布内容
- `releases/v1.4.0/MouseControl_v1.4.0_Portable.zip`

---

## 版本 1.3.3

### 🐛 Bug修复

#### 启动脚本优化
- ✅ **修复启动误报问题** - 移除不可靠的进程检测逻辑
- ✅ **简化启动流程** - 程序启动后直接提示成功，不再误报"启动失败"
- ✅ **优化用户体验** - 提供清晰的使用提示和故障排查指南
- ✅ **减少等待时间** - 启动等待从3秒优化到2秒

#### 问题说明
- 原启动脚本使用 `tasklist` 检测进程，但Flutter应用启动较慢导致检测失败
- 即使程序正常运行，也会显示"程序启动失败"误导用户
- 新版本移除进程检测，提供更友好的提示信息

### 📦 发布内容
- `releases/v1.3.3/MouseControl_v1.3.3_Portable.zip`

---

## 版本 1.3.2

### 🎯 版本管理优化 ⭐

#### 统一版本号管理
- ✅ 创建 `VERSION` 文件作为唯一版本号来源
- ✅ 创建 `lib/version.dart` 统一管理应用版本
- ✅ 自动从 `VERSION` 文件读取版本号
- ✅ 主界面标题栏显示版本号

#### 发布流程自动化 ⭐
- ✅ 全自动打包脚本，无需任何手动干预
- ✅ 创建 `scripts/create_helper_files.bat` 动态生成辅助文件
- ✅ 按版本号组织发布目录：`releases/v{VERSION}/`
- ✅ 自动生成所有用户文档（使用说明.txt、常见问题.txt等）
- ✅ 移除所有硬编码的版本号

#### 发版检查清单
```
1. 更新 VERSION 文件
2. 更新 lib/version.dart
3. 更新 CHANGELOG.md
4. 运行 scripts\build_release.bat
5. 完成！无需其他操作
```

### ✨ 新功能

#### 完整日志系统 ⭐
- ✅ 添加专业的日志管理服务 `LoggerService`
- ✅ 日志自动保存到 `logs/` 目录
- ✅ 按日期命名：`app_YYYYMMDD.log`
- ✅ 自动清理7天前的旧日志
- ✅ 四级日志：DEBUG/INFO/WARNING/ERROR
- ✅ UTF-8编码，支持中文
- ✅ 时间戳精确到毫秒

#### 辅助诊断脚本 ⭐
- ✅ **查看日志.bat** - 快速查看最新日志
- ✅ **调试启动.bat** - 显示详细错误信息
- ✅ **启动.bat** - 改进的启动脚本（自动检查、管理员权限提示）

### 📊 日志内容

记录所有关键操作：
- 应用启动和关闭
- 热键系统初始化
- 快捷键注册和触发
- 自动点击开始/停止
- 点击统计（每10次）
- 错误和异常堆栈

### 🔧 改进

#### 用户体验
- ✅ 更详细的错误提示
- ✅ 更容易的故障排查
- ✅ 专业的日志查看工具
- ✅ 改进的启动脚本
- ✅ 主界面显示版本号

#### 开发者体验
- ✅ 统一的日志接口
- ✅ 统一的版本号管理
- ✅ 全自动化发布流程
- ✅ 自动日志轮转
- ✅ 控制台和文件双输出
- ✅ 详细的日志文档

#### 项目结构
- ✅ `VERSION` - 版本号文件（唯一来源）
- ✅ `lib/version.dart` - Dart版本常量
- ✅ `scripts/create_helper_files.bat` - 辅助文件生成器
- ✅ `releases/v{VERSION}/` - 版本化发布目录

### 📦 依赖更新

- ✅ 新增 `logger: ^2.0.2` - 日志框架
- ✅ 新增 `path_provider: ^2.1.1` - 路径管理

### 🐛 修复

- ✅ 修复启动脚本无法显示窗口的问题
- ✅ 改进进程检测逻辑
- ✅ 更好的错误诊断提示
- ✅ 消除所有版本号硬编码
- ✅ 发版脚本全自动化，无需手动干预

---

## 版本 1.3.1

### 🐛 Bug修复

#### 打包缺少插件DLL ⭐
- ✅ 修复打包后缺少 `window_manager_plugin.dll` 的问题
- ✅ 修复打包后缺少 `screen_retriever_windows_plugin.dll` 的问题
- ✅ 更新 `build_release.bat` 自动复制所有必需DLL
- ✅ 现在便携版包含所有必需文件：
  - `mouse_control.exe` - 主程序
  - `flutter_windows.dll` - Flutter运行时
  - `window_manager_plugin.dll` - 窗口管理插件 ✓
  - `screen_retriever_windows_plugin.dll` - 屏幕信息插件 ✓
  - `mouse_controller.dll` - 鼠标控制
  - `data\` - 资源文件夹

### 📦 打包改进
- ✅ 完善发布打包流程
- ✅ 添加详细注释说明文件作用
- ✅ 确保所有依赖都被正确打包

---

## 版本 1.3.0

### ✨ 新功能

#### 1. 自动跟踪模式 ⭐
- ✅ 默认开启自动跟踪，实时跟随鼠标位置
- ✅ 无需手动点击"捕获"按钮
- ✅ 绿色"自动"标签显示当前模式

#### 2. 手动输入模式 ⭐
- ✅ 点击X或Y输入框自动切换到手动模式
- ✅ 点击🔄按钮可切换自动/手动模式
- ✅ 手动模式可输入固定坐标
- ✅ 灰色"手动"标签显示状态

#### 3. 简化快捷键 ⭐
- ✅ 改用数字键：`Ctrl+Shift+1` 和 `Ctrl+Shift+2`
- ✅ 快捷键1：开始/停止点击
- ✅ 快捷键2：捕获当前位置
- ✅ 更简单易记的组合

#### 4. 实时参数同步 ⭐
- ✅ UI参数自动同步到后台服务（每200ms）
- ✅ 启动后快捷键立即可用
- ✅ 无需先点"开始点击"按钮

### 🎨 界面改进
- ✅ 自动/手动模式切换按钮（🔄图标）
- ✅ 自动模式下禁用坐标输入框
- ✅ 模式状态标签（绿色/灰色）
- ✅ 主界面显示两个快捷键

### 🔧 技术改进
- ✅ 定时器持续更新服务参数
- ✅ 改进快捷键初始化逻辑
- ✅ 更详细的日志输出

---

## 版本 1.1.1

### ✨ 新增功能

#### 1. 时间精确到毫秒 ⭐
- ✅ 点击历史时间显示格式：`HH:MM:SS.mmm`
- ✅ 例如：`12:34:56.789`
- ✅ 更精确的时间记录，适合快速点击场景

#### 2. 主界面显示当前快捷键 ⭐
- ✅ 在状态卡片中实时显示当前快捷键
- ✅ 格式：`Ctrl + Shift + [按键]`
- ✅ 紫色背景主题，美观易识别
- ✅ 更换快捷键后自动更新显示

### 🎨 界面改进

#### 状态卡片增强
```
┌────────────────────────────────────┐
│ 🖱️ 当前位置: (100,200)  [5次]    │
│ ⌨️ 当前快捷键: Ctrl + Shift + S   │
└────────────────────────────────────┘
```

#### 控制按钮简化
- 移除按钮上的快捷键文本（已在上方显示）
- 按钮文字：`开始点击` / `停止点击`
- 更简洁的界面设计

---

## 版本 1.1.0

### ✨ 新功能

#### 1. 点击历史记录展示
- ✅ 显示最近10次点击记录
- ✅ 每条记录包含：
  - **序号**: 显示点击顺序（1-10）
  - **时间**: 精确到秒的时间戳（HH:MM:SS）
  - **位置**: 点击的X、Y坐标
  - **按键**: 左键/右键/中键标识（带颜色区分）
- ✅ 颜色标识：
  - 🔵 **蓝色** = 左键
  - 🟠 **橙色** = 右键
  - 🟣 **紫色** = 中键
- ✅ 奇偶行背景色交替，便于阅读
- ✅ 空状态提示（无记录时显示友好提示）

#### 2. 界面优化
- ✅ 固定窗口大小：520x680像素
- ✅ 移除滚动条，所有内容完整展示
- ✅ 紧凑的卡片式布局
- ✅ 优化了控件间距
- ✅ 点击历史使用Expanded自动填充剩余空间

#### 3. 快捷键功能增强
- ✅ 添加快捷键初始化状态日志
- ✅ 快捷键注册失败时显示详细错误信息
- ✅ 改进的错误提示（可能原因分析）

### 🔧 技术改进

- **DLL加载检查**: 增加启动时的DLL检查和错误提示
- **调试信息**: 在控制台输出热键系统状态
- **错误处理**: 更完善的错误捕获和用户提示

### 📊 界面布局（从上到下）

```
┌────────────────────────────────────┐
│  标题栏 + 快捷键设置按钮            │
├────────────────────────────────────┤
│  📍 当前位置 + 点击次数统计         │
├────────────────────────────────────┤
│  🎯 目标位置设置 (X, Y, 捕获)      │
├────────────────────────────────────┤
│  ⚙️ 点击设置                        │
│    - 间隔(ms) / 随机±(ms) / 偏移   │
│    - 鼠标按钮选择 (左/右/中)       │
├────────────────────────────────────┤
│  ▶️ 开始/停止按钮 (带快捷键提示)    │
├────────────────────────────────────┤
│  📜 点击历史记录列表                │
│    序号 | 时间 | 位置 | 按键        │
│    -------------------------------- │
│    [1]  12:34:56  (100,200)  [左键]│
│    [2]  12:34:57  (101,201)  [左键]│
│    ...                              │
└────────────────────────────────────┘
```

### 🎨 界面特点

1. **紧凑设计**: 固定窗口大小，无需滚动
2. **信息丰富**: 实时显示位置、状态、历史
3. **颜色编码**: 使用颜色区分不同按钮类型
4. **视觉层次**: 卡片+阴影营造层次感
5. **状态清晰**: 运行状态、点击次数一目了然

---

## 版本 1.0.0

### ✨ 初始功能

#### 核心功能
- ✅ 自动鼠标点击（左键/右键/中键）
- ✅ 精确位置定位和实时捕获
- ✅ 自定义点击间隔
- ✅ 随机时间间隔
- ✅ 随机位置偏移
- ✅ 全局快捷键支持（Ctrl+Shift+按键）
- ✅ 点击次数统计
- ✅ 实时鼠标位置显示

#### 快捷键系统
- ✅ 可视化快捷键设置界面
- ✅ 支持A-Z和0-9共36个按键
- ✅ 默认快捷键：Ctrl+Shift+S
- ✅ 全局热键监听

#### 技术栈
- Flutter 3.10.0+
- C++ (Windows API)
- FFI (Foreign Function Interface)
- window_manager 0.5.1

---

## 使用说明

### 快速开始

#### 方法1：使用调试脚本（推荐）
```bash
run_debug.bat
```

#### 方法2：手动启动
```bash
# 1. 复制DLL
copy native\src\mouse_controller.dll .

# 2. 安装依赖
flutter pub get

# 3. 运行应用
flutter run -d windows
```

### 查看点击历史

1. 设置目标位置和点击参数
2. 点击"开始点击"或使用快捷键
3. 在窗口底部的"点击历史"区域查看记录
4. 历史记录自动更新，最多显示10条

### 历史记录说明

- **序号**: 从1开始，最新的在最上面
- **时间**: 24小时格式，精确到秒
- **位置**: 实际点击的屏幕坐标（包含随机偏移）
- **按键**: 显示使用的鼠标按键，带颜色标识

---

## 已知问题

### 快捷键不工作？

**解决方法**:
1. 查看控制台日志：
   - "热键系统初始化: 成功/失败"
   - "热键注册: 成功/失败"
2. 如果显示失败：
   - 以管理员权限运行 `run_debug.bat`
   - 更换其他不常用的按键
   - 确保 `mouse_controller.dll` 在应用目录

### 界面显示不完整？

**解决方法**:
- 确保窗口大小为 520x680
- 不要手动调整窗口大小
- 重启应用

---

## 开发信息

### 文件结构
```
mouse_control/
├── lib/
│   ├── main.dart                      # 主界面（含历史记录UI）
│   ├── mouse_controller_bindings.dart # FFI绑定
│   └── mouse_controller_service.dart  # 业务逻辑（含历史记录管理）
├── native/
│   └── src/
│       ├── mouse_controller.cpp       # C++实现
│       ├── mouse_controller.h
│       └── mouse_controller.dll
├── run_debug.bat                      # 调试启动脚本
└── CHANGELOG.md                       # 本文件
```

### 调试建议

1. **查看控制台输出**: 运行 `run_debug.bat` 查看详细日志
2. **检查DLL状态**: 确保DLL在根目录
3. **管理员权限**: 某些功能可能需要管理员权限
4. **热键冲突**: 尝试不同的按键组合

---

## 未来计划

- [ ] 支持导出点击历史到文件
- [ ] 添加点击模式（单次/循环N次/无限循环）
- [ ] 支持多个位置序列点击
- [ ] 添加条件触发（颜色检测等）
- [ ] 支持自定义点击序列录制
- [ ] 添加统计图表
- [ ] 支持配置文件保存/加载

---

**当前版本**: v1.1.0  
**更新日期**: 2024-11-21  
**支持系统**: Windows 10/11  

